# 외부에서 가상 머신 접속 하기 (포트포워딩)

> VPN접속 없이 외부에서 가상머신 접속이 필요 할 때 사용합니다. 보안상 위험할 수 있으니 꼭 필요한 경우에만 사용바랍니다.&#x20;

## 1. 포트포워딩 개념

### 1.1  IP주소 종류&#x20;

<figure><img src="../../.gitbook/assets/image (59).png" alt=""><figcaption></figcaption></figure>

IP주소는 공인 IP주소와 사설IP주소로 나누어 집니다.&#x20;

* 공인IP주소 : 전세계에서 유일한 값으로 중복이 없어 외부에서 접속 가능합니다.&#x20;
* 사설IP주소 : 특정 관리 네트워크(공유기, VPN)에서만 유일한 값으로, 전세계적으로 중복 될수 있습니다. 특정 관리 네트워크에서만 접속이 가능합니다.&#x20;

보안 및 부족한 IP주소 문제를 해결하기 위해 사설 IP를 사용합니다.&#x20;

사설 IP 사용 절차는 다음과 같습니다.&#x20;

1. 인터넷 서비스 가입시 ISP(KT)는 공인IP중에서 한개를 할당 합니다.&#x20;
2. 사용자는 공유기에 공인 IP를 대표 IP(211.100.100.1)로 설정합니다.&#x20;
3. 내부에 여러 장비(컴퓨터, 휴대폰, TV)는 사설 IP(172.1.1.1\~3)를 할당 받아 사용합니다.&#x20;

### 1.2 포트포워딩 동작원리

<figure><img src="../../.gitbook/assets/image (61).png" alt=""><figcaption></figcaption></figure>

사설 IP는 특정 관리 네트워크에서만 통신의 되기 때문에 외부에서 접속 할수 없습니다. 이때 포트포워딩 기술을 사용하면 외부 접속이 가능합니다.&#x20;

동작 원리는 다음과 같습니다.&#x20;

1. 외부에서 접속하게 할 사설IP(내부IP) 주소와  내부포트 번호를 선택 합니다. (예 : 내부 IP = 172.1.1.2, 내부포트번호 = 3527)
2. 공인IP 주소와 임의의  외부포트 번호를 선택 합니다. (예 : 공인 IP=211.100.100.1,  외부포트번호 = 6854
3. 두 정보를 공유기에 기록하여 처리외합니다.  \
   (예: 외부에서 211.100.100.1:6854 port로 접속하면 172.1.1.2:3527로 전달forward해줍니다. )



## 2. 포트포워딩 적용하기&#x20;

포트포워딩 기능은 프로젝트별로 각 가상머신(인스턴스)마다 할당 할 수 있습니다.&#x20;

<figure><img src="../../.gitbook/assets/image (62).png" alt=""><figcaption></figcaption></figure>

1. 포트포워딩을 적용할 가상머신(인스턴스)를 선택 합니다. \
   . 해당 프로젝트내에 있는 가상머신만 선택 할 수 있습니다. \
   . 위 설명에서 내부IP(사설IP)를 지정 하는 부분입니다.
2. 적용할 프로토콜을 선택 합니다. TCP와 UDP 중에서 선택 할 수 있습니다.&#x20;
3. 가상머신(인스턴스)에서 사용하는 내부 포트 번호를 입력 합니다. \
   . ssh 의 경우 22번 포트를 사용합니다.&#x20;
4. 설명글을 입력 합니다. (예: ssh 서비스)
5. 입력 완료시 추가를 선택 합니다.&#x20;
6. 프로젝트 내 가상머신(인스턴스)마다 할당 된 포트 정보를 볼 수 있습니다.&#x20;
7. 사용하지 않는 포트를 삭제 할 수 있습니다.&#x20;

## 3. 접속 방법&#x20;

{% hint style="info" %}
외부에서는 공인IP 211.199.20.7을 이용하여 접속 할 수 있습니다. (http only)
{% endhint %}

### 3.1 SSH 접속 하기&#x20;

<figure><img src="../../.gitbook/assets/image (63).png" alt=""><figcaption></figcaption></figure>

1. VPN 접속 후 내부 IP로 접속 하기 \
   . Host : 10.10.17.3\
   . Port : 22
2. 포트포워딩 설정 후 외부 IP로 접속 하기 \
   . Host : 211.199.20.7\
   . Port : 20170 (임시 할당 번호)

IP주소와 포트번호가 다르지만 같은 서버에 접속 하는것을 확인 할수 있습니다.&#x20;



### 3.2 웹서비스 접속 하기&#x20;

<figure><img src="../../.gitbook/assets/image (64).png" alt=""><figcaption></figcaption></figure>

1. VPN 접속 후 내부 IP로 접속 하기 \
   . Host : 10.10.17.3\
   . Port : 8080
2. 포트포워딩 설정 후 외부 IP로 접속 하기 \
   . Host : 211.199.20.7\
   . Port : 6854 (임시 할당 번호)

IP주소와 포트번호가 다르지만 같은 서버에 접속 하는것을 확인 할수 있습니다.&#x20;
